# 要件定義書: 05_コンテンツ拡張とゲーム完成

## 概要
この文書は、ローグライクRPG開発の最終マイルストーンである「コンテンツ拡張とゲーム完成」の要件を定義する。

## 完了目標
-   ゲームに多様な敵とアイテムが登場し、リプレイ性が向上する。
-   地下20階の宝物を入手することで、ゲームがクリア可能になる。
-   ゲームクリア後に、プレイヤーの功績を称えるスコアが表示される。
-   ゲーム全体のバランスが調整され、テストプレイでクリア可能であることが確認される。

## 実行計画 (チェックリスト)
- [ ] **データ定義の拡張**
    - [ ] `assets/enemies.json` に、10種類以上の敵データを追加する。
    - [ ] `assets/items.json` に、ポーション、スクロール、武器、防具、アクセサリをそれぞれ5種類以上、合計25種類以上のアイテムデータを追加する。
- [ ] **Domain層**
    - [ ] `ecs/components.py` に、ゲームクリアアイテムを示す `TreasureComponent` を追加する。
    - [ ] `ecs/components.py` に、アクセサリ用の `ACCESSORY` を `EquipmentSlot` Enum に追加する。
    - [ ] スクロールなど、新しいアイテム効果に対応するためのコンポーネントやロジックを追加する（例：`ConfusionComponent`）。
- [ ] **Application層**
    - [ ] `GameLoop` を拡張し、地下20階に到達した際に、階段の代わりに宝物を生成するようにする。
    - [ ] `pickup_item` サービスを拡張し、`TreasureComponent` を持つアイテムを拾うとゲームクリア（`GameState.VICTORY`）になるようにする。
    - [ ] `use_item` サービスを拡張し、範囲攻撃や状態異常など、新しいスクロールの効果を実装する。
    - [ ] `calculate_score` サービスを実装し、到達階層や倒した敵の数に基づいてスコアを計算する。
- [ ] **Presentation層**
    - [ ] ターゲット選択（例：範囲攻撃スクロール）が必要なアイテムのためのUIを実装する。
    - [ ] `main.py` に、ゲームクリア時に表示される「勝利画面」と「スコア表示画面」のロジックを追加する。
- [ ] **テストとバランス調整**
    - [ ] 新しく追加したアイテム効果（範囲攻撃など）のロジックをテストする。
    - [ ] 勝利条件とスコア計算が正しく機能することをテストする。
    - [ ] 開発者によるテストプレイを行い、ゲームバランスを調整し、クリア可能であることを確認する。
- [ ] **ドキュメント**
    - [ ] `README.md` に、ゲームの目的（地下20階の宝）と、追加されたアイテムや操作方法について追記する。