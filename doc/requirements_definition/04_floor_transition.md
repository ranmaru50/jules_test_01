# 要件定義書: 04_階層移動とゲーム進行

## 概要
この文書は、ローグライクRPG開発の第四のマイルストーンである「階層移動とゲーム進行システム」の要件を定義する。

## 完了目標
-   プレイヤーはダンジョンのより深い階層へ進むことができる。
-   新しい階層に進むと、新しいマップが生成される。
-   階層が深くなるにつれて、ゲームの難易度が上昇する（敵やアイテムの数が増える）。
-   プレイヤーのステータスや持ち物は、階層を移動しても維持される。

## 実行計画 (チェックリスト)
- [ ] **Domain層**
    - [ ] `ecs/components.py` に `StairsComponent` を追加する。
    - [ ] `mapgen.py` を更新し、マップ生成時に下り階段を1つ配置するロジックを追加する。
- [ ] **Application層**
    - [ ] `GameLoop` に現在の階層レベルを追跡する `dungeon_level` 属性を追加する。
    - [ ] `GameLoop` に、新しいフロアを生成する `next_floor` メソッドを実装する。
        - [ ] プレイヤー以外のエンティティをクリアする。
        - [ ] 新しいマップを生成する（難易度を考慮）。
        - [ ] プレイヤーを新しいマップに再配置する。
    - [ ] `services.py` に、プレイヤーが階段を使用するための `descend_stairs_service` を実装する。
    - [ ] `GameLoop` の `process_input` を更新し、階段の上で特定のキーを押すと `descend_stairs_service` が呼び出されるようにする。
- [ ] **Presentation層**
    - [ ] `DungeonRenderer` のUI領域に、現在の階層レベル（例: B1F）を表示する機能を追加する。
- [ ] **テスト**
    - [ ] `next_floor` メソッドが、プレイヤーの状態を維持しつつ、マップと敵/アイテムを正しくリセット＆再生成することをテストする。
    - [ ] 階層レベルに応じて難易度（敵の数など）が上昇することをテストする。
- [ ] **ドキュメント**
    - [ ] `README.md` に、階層移動の操作方法について追記する。